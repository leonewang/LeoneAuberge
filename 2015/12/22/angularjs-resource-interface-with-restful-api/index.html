<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><title> AngularJS Resource Interface with RESTful API · Leone Auberge</title><meta name="description" content="
REF:AngularJS Documenthttp://harttle.com/2015/06/05/angular-resource.html

REST（表征性状态传输，Representational State Transfer）是Roy Fielding博士在2000年他的博士论文中提出来的一种软件架构风格。RESTful风格的设计不仅具有更好的可读性（Human Readable），而且易于做缓存以及服务器扩展（scalability）。REST风格体现在URL设计上：

每个URL对应一个资源&lt;/li"><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="short icon" href="/favicon.png"><link rel="stylesheet" href="/css/apollo.css"><link rel="stylesheet" href="http://fonts.useso.com/css?family=Source+Sans+Pro:400,600" type="text/css"></head><body><header><a href="/" class="logo-link"><img src="/favicon.png"></a><ul class="nav nav-list"><li class="nav-list-item"><a href="/" target="_self" class="nav-list-link">博客</a></li><li class="nav-list-item"><a href="/share" target="_self" class="nav-list-link">分享</a></li><li class="nav-list-item"><a href="/atom.xml" target="_self" class="nav-list-link">RSS</a></li><li class="nav-list-item"><a href="https://github.com/leonewang" target="_blank" class="nav-list-link">GITHUB</a></li></ul></header><section class="container"><div class="post"><article class="post-block"><h1 class="post-title">AngularJS Resource Interface with RESTful API</h1><div class="post-meta"><div class="post-time">2015年12月22日</div></div><div class="post-content"><blockquote>
<p>REF:<br><a href="https://docs.angularjs.org/api/ngResource/service/$resource" target="_blank" rel="external">AngularJS Document</a><br><a href="http://harttle.com/2015/06/05/angular-resource.html" target="_blank" rel="external">http://harttle.com/2015/06/05/angular-resource.html</a></p>
</blockquote>
<p><a href="https://zh.wikipedia.org/zh-cn/REST" target="_blank" rel="external">REST</a>（表征性状态传输，Representational State Transfer）是Roy Fielding博士在2000年他的博士论文中提出来的一种软件架构风格。RESTful风格的设计不仅具有更好的可读性（Human Readable），而且易于做缓存以及服务器扩展（scalability）。REST风格体现在URL设计上：</p>
<ul>
<li>每个URL对应一个资源</li>
<li>对资源的不同操作对应于HTTP的不同方法</li>
<li>资源表现形式（representation）通过<code>Accept</code>和<code>Content-Type</code>指定<br>AngularJS提供了$resourceService来更方便地与RESTful服务器API进行交互，可以方便地定义一个REST资源，而不必手动所有的声明CRUD方法。<a id="more"></a>
<h2 id="Resource_Factory"><a href="#Resource_Factory" class="headerlink" title="Resource Factory"></a>Resource Factory</h2></li>
</ul>
<p><code>$resourceService</code>定义在<code>ngResourceModule</code>中，需要在你的HTML中引入这个Module对应的JS，同时在你的APP中添加这样一个依赖：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> app = angular.module(<span class="string">'helloApp'</span>, [<span class="string">'ngResource'</span>]);</span><br></pre></td></tr></table></figure>
<p>然后为资源建立一个Factory：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.factory(<span class="string">'Notes'</span>, [<span class="string">'$resource'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$resource</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $resource(<span class="string">'/notes/:id'</span>);</span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>
<p>当然，你也可以不把<code>$resource的</code>实例放到Factory里，直接在控制器中存起来：<code>var Notes = $resource(&#39;/notes/:id&#39;)</code>。</p>
<p>CRUD</p>
<p>在你的控制器中就可以对资源进行增删改查了：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">app.controller(<span class="string">'NotesCtrl'</span>, [<span class="string">'$scope'</span>, <span class="string">'Notes'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$scope, Notes</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> notes = Notes.query(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="comment">// GET: /notes</span></span><br><span class="line">        <span class="comment">// Response: [&#123;id: 1, content: 'hello'&#125;, &#123;id: 2, content: 'world'&#125;];</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> first = notes[<span class="number">0</span>];</span><br><span class="line">        first.content = <span class="string">'halo'</span>;</span><br><span class="line">        first.$save();</span><br><span class="line">        <span class="comment">// POST: /notes/1 &#123;id: 1, content: 'halo'&#125;</span></span><br><span class="line">        <span class="comment">// Response: &#123;id: 1, content: 'halo'&#125;</span></span><br><span class="line"></span><br><span class="line">        second.$<span class="keyword">delete</span>();</span><br><span class="line">        <span class="comment">// DELETE: /notes/2</span></span><br><span class="line">    &#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> note = <span class="keyword">new</span> Notes(&#123;content: <span class="string">'xxx'</span>&#125;);</span><br><span class="line">    note.$save();</span><br><span class="line">    <span class="comment">// POST: /notes</span></span><br><span class="line">    <span class="comment">// Response: &#123;id: 3, content: 'xxx'&#125;</span></span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>
<h2 id="PUT__u64CD_u4F5C"><a href="#PUT__u64CD_u4F5C" class="headerlink" title="PUT 操作"></a>PUT 操作</h2><p><code>$resource</code>提供了五种默认操作：<code>get</code>, <code>query</code>, <code>save</code>, <code>remove</code>, <code>delete</code>。你可以配置一个update操作来完成HTTP PUT：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">app.factory(<span class="string">'Notes'</span>, [<span class="string">'$resource'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">$resource</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> $resource(<span class="string">'/notes/:id'</span>, <span class="literal">null</span>, &#123;</span><br><span class="line">        update: &#123; method:<span class="string">'PUT'</span> &#125;</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;]);</span><br></pre></td></tr></table></figure>
<p>现在，你可以在控制器中获取一个note并更新它：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> note = Notes.get(&#123; id: <span class="number">3</span>&#125;),</span><br><span class="line">    $id = note.id;</span><br><span class="line"></span><br><span class="line">note.content = <span class="string">'yyy'</span>;</span><br><span class="line">Notes.update(&#123; id:$id &#125;, note);</span><br><span class="line"><span class="comment">// PUT /notes/3 &#123;id: 3, content: 'yyy'&#125;</span></span><br></pre></td></tr></table></figure>
<p>现在你的Notes有六种操作了。这些操作有两种调用方式：</p>
<ul>
<li>通过资源类调用，例如：<code>Notes.update({id: xxx})；</code></li>
<li>通过资源实例调用，例如：<code>note.$update()</code>，此时操作名需加前缀$。<br>具体的调用参数可参考文档：</li>
</ul>
<blockquote>
<p>HTTP GET “class” actions: Resource.action([parameters], [success], [error])<br>non-GET “class” actions: Resource.action([parameters], postData, [success], [error])<br>non-GET instance actions: instance.$action([parameters], [success], [error])</p>
</blockquote>
<p>其中，success参数为<code>(value, responseHeaders)</code>，error参数为<code>(httpResponse)</code>。</p>
<h2 id="u5C5E_u6027/URL_u6620_u5C04"><a href="#u5C5E_u6027/URL_u6620_u5C04" class="headerlink" title="属性/URL映射"></a>属性/URL映射</h2><p>上述例子中，我们看到note对象的id属性会映射到URL中的<code>:id</code>（<code>/notes/:id</code>）。如果你的业务更加复杂，可以手动配置这个映射关系。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Notes = $resouce(<span class="string">'/users/:userId/notes/:noteId'</span>, &#123;</span><br><span class="line">    noteId: <span class="string">'@id'</span>,</span><br><span class="line">    userId: <span class="string">'@owner'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>将会 <strong>读取note的owner和id属性</strong> 来生成URL，比如删除note时：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// note === &#123;id: 123, owner: 'alice', content: 'hello'&#125;</span></span><br><span class="line">note.$<span class="keyword">delete</span>();</span><br><span class="line"><span class="comment">// DELETE: /users/alice/notes/123</span></span><br></pre></td></tr></table></figure>
<p><strong>在构造<code>$resource</code>时，多于的属性映射会成为URL Query</strong>。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Notes = $resouce(<span class="string">'/notes/:id'</span>, &#123;</span><br><span class="line">    id: <span class="string">'@id'</span>,</span><br><span class="line">    user: <span class="string">'@owner'</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// note === &#123;id: 123, owner: 'alice', content: 'hello'&#125;</span></span><br><span class="line">note.$<span class="keyword">delete</span>();</span><br><span class="line"><span class="comment">// DELETE: /notes/123?user=alice</span></span><br></pre></td></tr></table></figure>
<p><strong>REST操作的声明和调用中，多于的属性会成为URL Query</strong>。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Notes = $resouce(<span class="string">'/notes/:id'</span>, &#123;id: <span class="string">'@id'</span>&#125;, &#123;</span><br><span class="line">    update: &#123;method: <span class="string">'PUT'</span>, operator: <span class="string">'bob'</span>&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">// note === &#123;id: 123, content: 'hello'&#125;</span></span><br><span class="line">note.$update(&#123;trusted: <span class="literal">true</span>&#125;);</span><br><span class="line"><span class="comment">// PUT: /notes/123?operator=bob&amp;trusted=true &#123;id: 123, content: 'hello'&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="u54CD_u5E94_u8F6C_u6362"><a href="#u54CD_u5E94_u8F6C_u6362" class="headerlink" title="响应转换"></a>响应转换</h2><p>有时基于既定的后台设计，无法提供完全RESTful的API，比如/notes返回的是一个分页器对象，而非数组。此时，我们仍然可以使用<code>$resource</code>，但需要设置响应转换回调。例如：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Notes = $resouce(<span class="string">'/notes/:id'</span>, <span class="literal">null</span>, &#123;</span><br><span class="line">    pager: &#123;</span><br><span class="line">        method: <span class="string">'GET'</span>,</span><br><span class="line">        transformResponse: <span class="function"><span class="keyword">function</span>(<span class="params">data, headers</span>)</span>&#123;</span><br><span class="line">            <span class="comment">// Server respond:</span></span><br><span class="line">            <span class="comment">// data = &#123;currentPage: 1,</span></span><br><span class="line">            <span class="comment">//    totalPage: 20,</span></span><br><span class="line">            <span class="comment">//    pageSize: 2,</span></span><br><span class="line">            <span class="comment">//    content: [&#123;id: 1, content: 'hello'&#125;, &#123;id: 2, content: 'world'&#125;]&#125;</span></span><br><span class="line">            <span class="keyword">var</span> pager = <span class="built_in">JSON</span>.parse(data);</span><br><span class="line">            <span class="keyword">return</span> pager.content;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">var</span> notes = Notes.query(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="comment">// GET: /notes</span></span><br><span class="line">    <span class="comment">// notes === [&#123;id: 1, content: 'hello'&#125;, &#123;id: 2, content: 'world'&#125;]</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>类似响应重写，你还可以设置请求转换<code>transformRequest</code>。</p>
<div class="tip">虽然<code>$resource</code>的设计可以支持绝大多数的URL和内容表示设计，但如果你发现<code>$resource</code>的使用过程极其复杂，那可能是你的服务器API并不满足RESTful风格。</div>
</div></article></div></section><footer><div class="paginator"><a href="/2016/01/01/github-gitcafe-domain-binding-principle/" class="prev">上一篇</a><a href="/2015/12/15/think-about-javascript-prototype-and-prototype-chain/" class="next">下一篇</a></div></footer><script>var _hmt = _hmt || [];(function() {var hm = document.createElement("script");hm.src = "//hm.baidu.com/hm.js?ed77053554825c09d2021287e3a25e51";var s = document.getElementsByTagName("script")[0]; s.parentNode.insertBefore(hm, s);})();</script><script src="https://cdn.bootcss.com/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script></body></html>